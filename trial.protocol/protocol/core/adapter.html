<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Adapter :: trial.protocol</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">trial.protocol</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://leminhos.gitlab.io/doc.trial.protocol/trial.protocol/protocol/home/introduction.html">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="https://www.boost.org/doc/libs/1_66_0/libs/libraries.htm">Libraries</a>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="https://www.boost.org/users/people.html">People</a>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://github.com/breese/trial.protocol">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="trial.protocol" data-version="protocol">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">trial.protocol</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Core</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="adapter.html">Adapter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="serialization.html">Serialization</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">JSON</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../json/json.html">JSON</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../json/tutorial.html">Tutorials</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../json/guide.html">User Guide</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Incremental Processing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../json/token.html">Token</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../json/error.html">Error</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../json/reader.html">Reader</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../json/writer.html">Writer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Serialization</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../json/iarchive.html">Input Archive</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../json/oarchive.html">Output Archive</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../json/design.html">Design Rationale</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Dynamic Variable</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dynamic/dynamic.html">Trial.Dynamic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dynamic/tutorial.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">User Guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../dynamic/type.html">dynamic:type.adoc</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../dynamic/function.html">Functions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../dynamic/algorithm.html">Algorithms</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../dynamic/converter.html">Converters</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../dynamic/concept.html">Concepts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dynamic/rationale.html">Design Rationale</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dynamic/acknowledgement.html">Acknowledgement</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">trial.protocol</span>
    <span class="version">protocol</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">trial.protocol</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">protocol</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../home/introduction.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">trial.protocol</a></li>
    <li>Core</li>
    <li><a href="adapter.html">Adapter</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://gitlab.com/Leminhos/breese-asciidoc-conversion/edit/antora/doc/modules/core/pages/adapter.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Adapter</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The core component contains types that are used by all protocols
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When generating a protocol-specific encoded output, the result is written to an
output buffer. Several types of output buffers can be used, such as arrays,
strings, and I/O streams. As these have different interfaces, each type is
wrapped by an adapter. Custom output buffer types can be added with adapter
traits.
The output buffer is passed via the constructor of the protocol generator.</p>
</div>
<div class="paragraph">
<p>Trial.protocol has support for a number of commonly used output buffer types.
Using any of these requires the inclusion of an associated header file as
shown in the table below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Header File</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CharT[N]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;trial/protocol/buffer/array.hpp&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::array&lt;CharT, N&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;trial/protocol/buffer/array.hpp&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::basic_ostream&lt;CharT&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;trial/protocol/buffer/ostream.hpp&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::basic_string&lt;CharT&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;trial/protocol/buffer/string.hpp&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>std::vector&lt;CharT&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;trial/protocol/buffer/vector.hpp&gt;</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>where <code>CharT</code> can be <code>char</code> or <code>unsigned char</code>. Wide characters are not
supported.</p>
</div>
<div class="paragraph">
<p>Support for other output buffer types can be added via adapter traits.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adapter_traits"><a class="anchor" href="#_adapter_traits"></a>Adapter Traits</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The encoded output can be written to other output buffer types.
This is done by specifying a buffer adapter and a trait to select this
buffer adapter for the output buffer type.</p>
</div>
<div class="paragraph">
<p>The buffer adapter must inherit from <code>buffer::base</code> and implement the
following API:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Member</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool grow(size_type)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserve space in the output buffer. Returns false if the requested space cannot be reserved, in which case no further data will be written to the output buffer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void write(value_type)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output a single character.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void write(const view_type&amp;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output a sequence of characters.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_tutorial_deque_adapter"><a class="anchor" href="#_tutorial_deque_adapter"></a>Tutorial: Deque Adapter</h3>
<div class="paragraph">
<p>Assume that we add support for <code>std::deque</code>. First the buffer wrapper for
<code>std::deque</code> is written like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cpp hljs" data-lang="cpp">#include &lt;deque&gt;
#include &lt;trial/protocol/buffer/base.hpp&gt;

namespace my {

template &lt;CharT&gt;
class deque_wrapper : public buffer::base&lt;CharT&gt;
{
public:
    using value_type = typename buffer::base&lt;CharT&gt;::value_type;
    using size_type = typename buffer::base&lt;CharT&gt;::size_type;
    using view_type = typename buffer::base&lt;CharT&gt;::view_type;

    deque_wrapper(std::deque&lt;value_type&gt;&amp; buffer)
        : buffer(buffer)
    {}

protected:
    virtual bool grow(size_type delta)
    {
        buffer.resize(buffer.size() + delta);
    }

    virtual void write(value_type value)
    {
        buffer.push_back(value);
    }

    virtual void write(const view_type&amp; view)
    {
        buffer.insert(buffer.end(), view.begin(), view.end());
    }

private:
    std::deque&lt;value_type&gt;&amp; buffer;
};

} // namespace my</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we must make this wrapper known to the protocol generator, which is done
as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cpp hljs" data-lang="cpp">namespace trial { namespace protocol { namespace buffer {

template &lt;typename T&gt;
struct traits&lt; std::deque&lt;T&gt; &gt;
{
    using buffer_type = my::deque_wrapper&lt;T&gt;;
};

}}}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>traits</code> struct must be located inside the <code>trial::protocol::buffer</code> namespace.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
